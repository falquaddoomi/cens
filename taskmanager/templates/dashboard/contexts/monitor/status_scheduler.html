{% extends "dashboard/contexts/monitor/status.html" %}

{% block status_styles %}
h2.my_h2 { margin: 0px; margin-bottom: 1em; }

.dispatch_entry {
	margin-bottom: 1em;
}

.dispatch_entry td { padding-right: 5px; padding-bottom: 5px; }

.dispatch_header {
	font-size: 14px; margin-bottom: 10px;
}

.dispatch_body {
	padding: 10px; background: #eee;
	-moz-border-radius: 5px;
	-webkit-border-radius: 5px;
	border-radius: 5px;
}

.dispatch_label {
	font-weight: bold;
	vertical-align: top; text-align: right;
}
{% endblock %}

{% block status_scripts %}
$(document).ready(function() {
	function refreshScheduler() {
		// show the spinner image
		$("#spinner_img").css('display','');

		// send an AJAX request to the scheduler for its status
		$.ajax({
		  url: '/proxy/' + encodeURIComponent('http://localhost:8080/status'),
		  dataType: 'text',
		  success: function(data) {
		  	out = "<h2 class=\"my_h2\">Scheduler: <span style=\"display: inline-block; width: 150px;\" class=\"task_status running\">running</span></h2>";

			$('#scheduler_status').html(out);

			// hide the spinner since we're done
			$("#spinner_img").fadeOut(600);
		  },
		  error: function() {
			$('#scheduler_status').html('<h2 class=\"my_h2\">Scheduler: <span style=\"display: inline-block; width: 150px;\" class=\"task_status due\">not running</span></h2>');

			// hide the spinner since we're done
			$("#spinner_img").fadeOut(600);
		  }
		});
	}

	// run it once to populate the view at first
	refreshScheduler();

	// then associate the same function with this button so we can refresh manually
	$("#refresh_status_btn").click(refreshScheduler);
});
{% endblock %}

{% block status_content %}
	<div id="scheduler_status">
	</div>

	<input type="button" id="refresh_status_btn" value="refresh status" />
	<img id="spinner_img" src="/static/taskmanager/images/ajax-loader-arrows.gif" style="vertical-align: middle; display: none;" />
{% endblock %}